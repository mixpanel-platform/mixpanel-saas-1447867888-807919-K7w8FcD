<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/css/reset.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.css">
    <script src="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.js"></script>
    <style type="text/css">

      form {
        padding:10px 0 0 0;
      }
    	
    	.module-container {
    		padding:10px;
    		border:solid 1px grey;
    		width:945px;
    		display: -webkit-flex;
    		display: flex;
    		-webkit-align-items: center;
    		align-items: center;
    		-webkit-justify-content: center;
    		justify-content: center;
    		-webkit-flex-flow: row wrap;
    		flex-flow: row wrap;
    		-webkit-align-content: stretch;
    		align-content: stretch;
    	}

      .modal {
        display: none;
        z-index:100;
        background-color: white;
        position: fixed;
        padding: 20px;
        left: 341px;
        top: 125px;
        width: 280px;
        border: 1px grey solid;
        margin: auto;
      }

      #overlay {
        background-color: #3c4c63;
        height: 100%;
        left: 0;
        opacity: .8;
        position: fixed;
        top: 0;
        width: 100%;
        z-index: 10;
        display:none;
      }

      .module {
        height:250px;
         margin:10px;
         padding:5px;
         border:solid 1px grey;   
      }

      .module .legend {
        position: relative;
        top: 50%;
        transform: translateY(-50%);
        margin:auto;
      }

    	.small {
    		-webkit-flex: 0 0 283px;
    		flex: 0 0 283px;
    	}

      .medium {
          -webkit-flex: 0 0 598px;
          flex: 0 0 598px;
      }

    	.large {
        height:435px;
    		-webkit-flex: 0 0 914px;
    		flex: 0 0 914px;
    	}

      .large .mixpanel-platform-output {
        bottom:108px;
      }

      .label {
        margin:5px 0 5px 0;
      }

    	.legend {
        width:260px;
    		padding-top:2px;
    		text-align:center;
    	}

      .add {
          height:30px;
          -webkit-flex: 0 0 240px;
          flex: 0 0 240px;
          order:1;
      }

      .eventDropdown {
      }

      .button {
        margin: 5px 0 5px;
        height:30px;
        -webkit-flex: 0 0 130px;
        flex: 0 0 130px;
        border:1px gray solid;
        border-radius: 3px;
        background-color: white;
        cursor: pointer;
      }

    </style>
  </head>

  <body class="mixpanel-platform-body">

    <div id="overlay"></div>

    <div class="module-container">

      <div class='segmentation1 large module'>
        <div class='legend'>
          <p class="label">Select an event:</p>
          <div class="eventDropdown"></div>
          <div class="segmentation1Button button">
            <div class="legend">Run</div>
          </div>
        </div>
      </div>

      <div class='medium module'><div class='legend'>#</div></div>
      <div class='small module'><div class='legend'>#</div></div>

      <div id="add-module" class="add module button"><div class='legend'>Add a module</div></div>

      <!-- HTML for modal. Hidden until someone adds a module. -->
      <div class="modal">
        <span class="label">Please select a module:</span>
        <form id="form" action="">
          <input type="radio" name="Segmentation" value="segmentation"> Segmentation<br>
          <input type="radio" name="Fuel Gauge" value="gauge"> Fuel Gauge<br>
          <input type="radio" name="Top Values" value="top"> Top Values <br><br>
        </form>
        <button id ="submit" class="button" name="Submit">Submit</button>
      </div>
          
      </div>
	
    </div>

    <script type="text/javascript">
      var modal = "<div class='modal'></div>";

      // Add modules. Pass a container and the size of the module.
      var addModule = function(container,type){
        // Nasty ternary operator
        var size = type == "segmentation" ? "large" : (type == "top" ? "medium" : "small");

        // Based on module type, append appropriate HTML string.
        if (type == "segmentation") {
          module = "<div class='"+type+" "+size+" module'><div class='legend'>This is a "+type+" module.</div></div>";
        } else if (type == "top" ) {
          module = "<div class='"+type+" "+size+" module'><div class='legend'>This is a "+type+" module.</div></div>";
        } else {
          module = "<div class='"+type+" "+size+" module'><div class='legend'>This is a "+type+" module.</div></div>"
        };

        // Append HTML to container.
        container.append(module);
      };

      // When user clicks "Add Module," add grey overlay and trigger the module selection modal.
      $("#add-module").click(function(){
        $("#overlay").toggle();
        $(".modal").toggle();
      });

      // Handle closing of the overlay on click
      $("#overlay").click(function(){
        if ($(this).css("display") == "none") {
          // Do nothing
        } else {
          $(".modal").css("display","none");
          $(this).toggle();
          $(this).checked = false;
        }
      });

      // Add a module and alert the user if they submit without a selected value
      $("#submit").click(function(){
        if ($("input[type='radio']:checked").length > 0){
          val = $("input[type='radio']:checked").val();
          console.log(val);
          addModule($(".module-container"),val);

          // Close modal and overlay after submit and also clear selections
          $(".modal").css("display","none");
          $("#overlay").toggle();
          $("input[type='radio']:checked").prop("checked",false);
        }
        else{
         alert("Please select a module.");
        }
      });

      // Check one radio button at a time
      $(document).ready(function () {
        $("input[type=radio]").change(function() {
          // When any radio button on the page is selected,
          // then deselect all other radio buttons.
          $("input[type=radio]:checked").not(this).prop("checked", false);
        });
      })

      // MPPlatform + JQL Queries
      $(document).ready(function() {

        // Populate various Platform visualizations and components
        $(".eventDropdown").MPEventSelect();

        // On click, run query.
        // $(".segmentation1").click(function(){
        //   MP.api.segment('Button clicked', '$city', {limit: 10}).done(function(results) {
        //      $('<div></div>').appendTo('body').MPTable({ // create table; try scrolling horizontally over demo below
        //        data: results,
        //        showPercentages: true,
        //        firstColHeader: 'Button clicked / city'
        //      });
        //    });
        // });

      var data = {
        'segment1': {
              '2010-09-01': 10,
              '2010-09-02': 11,
              '2010-09-03': 8
          },
          'segment2': {
              '2010-09-01': 1,
              '2010-09-02': 18,
              '2010-09-03': 17
          },
          'segment3': {
              '2010-09-01': 32,
              '2010-09-02': 37,
              '2010-09-03': 30
          }
      };
      $(".segmentation1Button").click(function() {
        var lineChart = $('<div></div>').appendTo('.segmentation1').MPChart({chartType: 'line', highchartsOptions: {
          tooltip: {
            backgroundColor: '#fffce7'  // Make tooltip background yellow
          }
        }});                                // Create a line chart
        lineChart.MPChart('setData', data); // Set the chart's data
      });
    });

    </script>
  </body>
</html>
