<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/css/reset.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.css">
    <script src="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.js"></script>
    
    <style type="text/css">
    	
    	.module-container {
    		padding:10px;
    		border:solid 1px grey;
    		width:945px;
    		display: -webkit-flex;
    		display: flex;
    		-webkit-align-items: center;
    		align-items: center;
    		-webkit-justify-content: center;
    		justify-content: center;
    		-webkit-flex-flow: row wrap;
    		flex-flow: row wrap;
    		-webkit-align-content: stretch;
    		align-content: stretch;
    	}

    	.small-module {
    		margin:10px;
    		padding:5px;
    		border:solid 1px grey;
    		/*width:288px;*/
    		-webkit-flex: 0 0 283px;
    		flex: 0 0 283px;
    	}

    	.large-module {
    		margin:10px;
    		padding:5px;
    		border:solid 1px black;
    		/*width:780px;*/
    		-webkit-flex: 0 0 914px;
    		flex: 0 0 914px;
    	}

    	.medium-module {
    		margin:10px;
    		padding:5px;
    		border:solid 1px white;
    		/*width:780px;*/
    		-webkit-flex: 0 0 598px;
    		flex: 0 0 598px;
    	}

    	.add-button {
    		text-align:center;
    		font-size:24px;
    		color:grey;
    	}

    	.legend {
    		padding-top:2px;
    		text-align:center;
    	}

    	.by {
    		float: left;
    		margin-right: 10px;
    		line-height: 32px;
    	}

    </style>
  </head>
  <body class="mixpanel-platform-body">

    <div class="module-container">
        <div class="large-module">
					<div class="mixpanel-platform-section">
						<div class="eventSelect" style="float: left;"></div>
						<div class="by" class="mixpanel-platform-label" style="margin-left: 10px; display: none;">by</div>
						<div class="propSelect" style="float: left;"></div>
						<div class="dateSelect" style="float: right;"></div>
						<div style="clear: both;"></div>
						<div class="graph"></div>
					</div>   	
        </div>	

        <div class="large-module">
					<div class="mixpanel-platform-section">
						<div class="eventSelect" style="float: left;"></div>
						<div class="by" class="mixpanel-platform-label" style="margin-left: 10px; display: none;">by</div>
						<div class="propSelect" style="float: left;"></div>
						<div class="dateSelect" style="float: right;"></div>
						<div style="clear: both;"></div>
						<div class="graph"></div>
					</div>   	
        </div>	

    </div>

	  <script>
			var eventSelect = $('.eventSelect').MPEventSelect();
			var propSelect  = $('.propSelect').MPPropertySelect();
			var dateSelect  = $('.dateSelect').MPDatepicker();
			var eventGraph  = $('.graph').MPChart({chartType: 'line'});
			
			var runQuery = function() {
			  var eventName = eventSelect.MPEventSelect('value'),
			      propName  = propSelect.MPPropertySelect('value'),
			      dateRange = dateSelect.MPDatepicker('value');
			  if (eventName) {
			    MP.api.segment(eventName, propName, dateRange).done(function(results) {
			      eventGraph.MPChart('setData', results);
			      eventTable.MPTable('setData', results);
			    });
			  }
			};

			eventSelect.on('change', function(e, eventName) {
			  propSelect.MPPropertySelect('setEvent', eventName);
			  $(".by").show();
			  runQuery();
			});
			propSelect.on('change', runQuery());
			dateSelect.on('change', runQuery());
	  </script>

  </body>
</html>
