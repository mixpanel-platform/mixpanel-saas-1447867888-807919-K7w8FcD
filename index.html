<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/css/reset.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.css">
    <script src="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.js"></script>
    
    <style type="text/css">
    	
    	.module-container {
    		padding:10px;
    		border:solid 1px grey;
    		width:945px;
    		display: -webkit-flex;
    		display: flex;
    		-webkit-align-items: center;
    		align-items: center;
    		-webkit-justify-content: center;
    		justify-content: center;
    		-webkit-flex-flow: row wrap;
    		flex-flow: row wrap;
    		-webkit-align-content: stretch;
    		align-content: stretch;
    	}

    	.small-module {
    		margin:10px;
    		padding:5px;
    		border:solid 1px grey;
    		/*width:288px;*/
    		-webkit-flex: 0 0 283px;
    		flex: 0 0 283px;
    	}

    	.large-module {
    		margin:10px;
    		padding:5px;
    		border:solid 1px black;
    		/*width:780px;*/
    		-webkit-flex: 0 0 914px;
    		flex: 0 0 914px;
    	}

    	.medium-module {
    		margin:10px;
    		padding:5px;
    		border:solid 1px white;
    		/*width:780px;*/
    		-webkit-flex: 0 0 598px;
    		flex: 0 0 598px;
    	}

    	.add-button {
    		text-align:center;
    		font-size:24px;
    		color:grey;
    	}

    	.legend {
    		padding-top:2px;
    		text-align:center;
    	}

    	.by {
    		float: left;
    		margin-right: 10px;
    		line-height: 32px;
    	}

    </style>
  </head>
  <body class="mixpanel-platform-body">

    <div class="module-container">
        <div class="large-module">
					<div class="mixpanel-platform-section">
						<div id="eventSelect0" style="float: left;"></div>
						<div class="by" class="mixpanel-platform-label" style="margin-left: 10px; display: none;">by</div>
						<div id="propSelect0" style="float: left;"></div>
						<div id="dateSelect0" style="float: right;"></div>
						<div style="clear: both;"></div>
						<div class="graph"></div>
					</div>   	
        </div>	

        <div class="large-module">
					<div class="mixpanel-platform-section">
						<div id="eventSelect1" style="float: left;"></div>
						<div class="by" class="mixpanel-platform-label" style="margin-left: 10px; display: none;">by</div>
						<div id="propSelect1" style="float: left;"></div>
						<div id="dateSelect1" style="float: right;"></div>
						<div style="clear: both;"></div>
						<div class="graph"></div>
					</div>   	
        </div>	

    </div>

	  <script>

	  	// Dynamically create and set events, props, and dates for each segmentation module.
			$('#eventSelect0').each(function(i){
				window["eventSelect" + i] = $(this).MPEventSelect();
				// alert(window["eventSelect" + i]);
	  	})

			$('#propSelect0').each(function(i){
				window["propSelect" + i] = $(this).MPPropertySelect();
				// alert(window["propSelect" + i]);
	  	})

			$('#dateSelect0').each(function(i){
				window["dateSelect" + i] = $(this).MPDatepicker();
				// alert(window["dateSelect" + i]);
	  	})	  		  	

			var eventGraph  = $('.graph').MPChart({chartType: 'line'});
			
			var runQuery = function(i) {
			  var eventName = window["eventSelect" + i].MPEventSelect('value'),
			      propName  = window["propSelect" + i].MPPropertySelect('value'),
			      dateRange = window["dateSelect" + i].MPDatepicker('value');
			  if (eventName) {
			    MP.api.segment(eventName, propName, dateRange).done(function(results) {
			      eventGraph.MPChart('setData', results);
			      // eventTable.MPTable('setData', results);
			    });
			  }
			};

			$('.eventSelect').on('change', function(e, eventName) {
			  window["propSelect" + i].MPPropertySelect('setEvent', eventName);
			  $(".by").show();
			  runQuery(i);
			});
			window["propSelect0"].on('change', runQuery(0));
			window["propSelect1"].on('change', runQuery(1));
			window["dateSelect0"].on('change', runQuery(0));
			window["dateSelect1"].on('change', runQuery(1));
	  </script>

  </body>
</html>
